<casaxml xsi:schemaLocation="http://casa.nrao.edu/schema/casa.xsd file:///opt/casa/code/xmlcasa/xml/casa.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://casa.nrao.edu/schema/psetTypes.html">

<task visibility="experimental" category="calibration" name="fringefit" type="function">
<shortdescription>Fringe fit delay and rates</shortdescription>
<description>
Phase offsets, groups delays and delay rates are calculated with
respect to a specified referance antenna by a two-dimensional FFT and
subsequent least-squares optimisation.

Previous calibrations should be applied on the fly.

</description>
<input>
<<<<<<< HEAD
  <param mustexist="true" name="vis" type="string">
    <shortdescription>Name of input visibility file</shortdescription>
    <description>Name of input visibility file
    Default: none
    Example: vis='ngc5921.ms'
    </description>
    <value/>
    
  </param>

  <param name="caltable" type="string">
    <shortdescription>Name of output fringefit calibration table</shortdescription>
    <description>Name of output gain calibration table
    Default: none
    Example: caltable='ngc5921.ff'
    </description>

    <value/>
  </param>

  <param name="field" type="string">
    <shortdescription>Select field using field id(s) or field name(s)</shortdescription>
    <description>Select field using field id(s) or field name(s)
    Default: '' (all fields)
    
    Use 'go listobs' to obtain the list id's or
    names. If field string is a non-negative integer,
    it is assumed a field index,  otherwise, it is
    assumed a field name.

    Examples:
    field='0~2'; field ids 0,1,2
    field='0,4,5~7'; field ids 0,4,5,6,7
    field='3C286,3C295'; field named 3C286 and
    3C295
    field = '3,4C*'; field id 3, all names
    starting with 4C
    </description>

    <value/>
  </param>
  <param name="spw" type="string">
    <shortdescription>Select spectral window/channels</shortdescription>
    <description>Select spectral window/channels
    Default: '' (all spectral windows and channels)
    Examples:
    spw='0~2,4'; spectral windows 0,1,2,4 (all
    channels)
    spw='&lt;2';  spectral windows less than 2
    (i.e. 0,1)
    spw='0:5~61'; spw 0, channels 5 to 61,
    INCLUSIVE
    spw='*:5~61'; all spw with channels 5 to 61
    spw='0,10,3:3~45'; spw 0,10 all channels, spw
    3, channels 3 to 45.
    spw='0~2:2~6'; spw 0,1,2 with channels 2
    through 6 in each.
    spw='0:0~10;15~60'; spectral window 0 with
    channels 0-10,15-60. (NOTE ';' to separate
    channel selections)
    spw='0:0~10^2,1:20~30^5'; spw 0, channels
    0,2,4,6,8,10, spw 1, channels 20,25,30 
    </description>
    <value/>
  </param>

  <param name="intent" type="string">
    <shortdescription>Select observing intent</shortdescription>
    <description>Select observing intent
    Default: '' (no selection by intent)
    Example: intent='*BANDPASS*'  (selects data
    labelled with BANDPASS intent)
    </description>

    <value/>
  </param>

  <param name="selectdata" type="bool">
    <shortdescription>Other data selection parameters</shortdescription>
    <description>Other data selection parameters
    Default: True
    Options: True|False
    </description>
    <value>True</value>
  </param>

  <param subparam="true" name="timerange" type="string">
    <shortdescription>Select data based on time range</shortdescription>
    <description>Select data based on time range
    Subparameter of selectdata=True
    Default: '' (all)

    Examples:
    timerange =
    'YYYY/MM/DD/hh:mm:ss~YYYY/MM/DD/hh:mm:ss'
    (Note: if YYYY/MM/DD is missing date defaults
    to first day in data set.)
    timerange='09:14:0~09:54:0' picks 40 min on
    first day 
    timerange= '25:00:00~27:30:00' picks 1 hr to 3
    hr 30min on NEXT day
    timerange='09:44:00' pick data within one
    integration of time
    timerange='&gt;10:24:00' data after this time
    </description>
    <value/>
  </param>

  <param subparam="true" name="antenna" type="string">
    <shortdescription>Select data based on antenna/baseline</shortdescription>
    <description>Select data based on antenna/baseline
    Subparameter of selectdata=True
    Default: '' (all)

    If antenna string is a non-negative integer, it
    is assumed to be an antenna index, otherwise, it is
    assumed to be an antenna name
    
    Examples: 
    antenna='5&amp;6'; baseline between antenna index 5 and index 6.
    antenna='VA05&amp;VA06'; baseline between VLA antenna 5 and 6.
    antenna='5&amp;6;7&amp;8'; baselines with indices 5-6 and 7-8
    antenna='5'; all baselines with antenna index 5
    antenna='05'; all baselines with antenna number 05 (VLA old name)
    antenna='5,6,10'; all baselines with antennas 5,6,10 index numbers
    </description>
    <value/>
  </param>

  <param subparam="true" name="scan" type="string">
    <shortdescription>Scan number range</shortdescription>
    <description>Scan number range
    Subparameter of selectdata=True
    Default: '' = all

    Check 'go listobs' to insure the scan numbers are
    in order.
    </description>
    <value/>
  </param>

  <param subparam="true" name="observation" type="any">
    <shortdescription>Select by observation ID(s)</shortdescription>
    <description>Select by observation ID(s)
    Subparameter of selectdata=True
    Default: '' = all

    Example: observation='0~2,4'
    </description>
    <type>string</type><type>int</type>
    <value type="string"/>
  </param>

  <param subparam="true" name="msselect" type="string">
    <shortdescription>Optional complex data selection (ignore for now)</shortdescription>
    <description>Optional complex data selection (ignore for now)</description>
    <value/>
  </param>

  <param name="solint" type="any">
    <shortdescription>Solution interval</shortdescription>
    <description>Solution interval
    Default: 'inf' (infinite, up to boundaries
    controlled by combine); 
    Options: 'inf' (~infinite), 'int' (per
    integration), any float or integer value with or
    without units

    Examples: 
    solint='1min'; solint='60s', solint=60 (i.e.,
    1 minute); solint='0s'; solint=0; solint='int'
    (i.e., per integration); solint-'-1s';
    solint='inf' (i.e., ~infinite, up to
    boundaries enforced by combine)
    </description>
    <any type="variant"/>
    <value type="string">inf</value>
  </param>

  <param name="combine" type="string">
    <shortdescription>Data axes to combine for solve (obs, scan, spw, and/or field)</shortdescription>
    <description>Data axes to combine for solve
    Default: 'scan' (solutions will break at obs,
    field, and spw boundaries)
    Options: '','obs','scan','spw',field', or any
    comma-separated combination in a single string

    Example: combine='scan,spw' - Extend solutions
    over scan boundaries (up to the solint), and
    combine spws for solving
    </description>
    <value/>
  </param>

  <param name="refant" type="string">
    <shortdescription>Reference antenna name(s)</shortdescription>
    <description>Reference antenna name(s); a prioritized list may be
    specified
    Default: '' (No refant applied)

    Examples: 
    refant='4' (antenna with index 4)
    refant='VA04' (VLA antenna #4)
    refant='EA02,EA23,EA13' (EVLA antenna EA02,
    use EA23 and EA13 as alternates if/when EA02
    drops out)

    Use taskname=listobs for antenna listing
    </description>
    <value/>
  </param>

  <param name="minsnr" type="double">
    <shortdescription>Reject solutions a signal-to-noise ratio</shortdescription>
    <description>Reject solutions below this signal-to-noise ratio after the FFT stage of fringefitting; only antennas with satisfactory signal-to-noise are included in the subsequent least-squares stage.
      Default: 3
    </description>
    <value>3.0</value>
  </param>

  <param name="zerorates" type="bool">
    <shortdescription>Zero delay-rates in solution table</shortdescription>
    <description>Zero delay-rates in solution table
    Default: False
    Options: True|False
=======
        <param mustexist="true" name="vis" type="string"><shortdescription>Name of input visibility file</shortdescription><description>Name of input visibility file</description>
                
                <value/>
        </param>

        <param name="caltable" type="string"><shortdescription>Name of output gain calibration table</shortdescription><description>Name of output gain calibration table</description>
                
                <value/>
        </param>

        <param name="field" type="string"><shortdescription>Select field using field id(s) or field name(s)</shortdescription><description>Select field using field id(s) or field name(s)</description>
                
                <value/>
        </param>

        <param name="spw" type="string"><shortdescription>Select spectral window/channels</shortdescription><description>Select spectral window/channels</description>
                
                <value/>
        </param>

        <param name="intent" type="string"><shortdescription>Select observing intent</shortdescription><description>Select observing intent</description>
                
                <value/>
        </param>

        <param name="selectdata" type="bool"><shortdescription>Other data selection parameters</shortdescription><description>Other data selection parameters</description>
                
                <value>True</value>
        </param>

        <param subparam="true" name="timerange" type="string"><shortdescription>Select data based on time range</shortdescription><description>Select data based on time range</description>
                
                <value/>
        </param>

        <param subparam="true" name="antenna" type="string"><shortdescription>Select data based on antenna/baseline</shortdescription><description>Select data based on antenna/baseline</description>
                
                <value/>
        </param>

        <param subparam="true" name="scan" type="string"><shortdescription>Scan number range</shortdescription><description>Scan number range</description>
                
                <value/>
        </param>

        <param subparam="true" name="observation" type="any"><shortdescription>Select by observation ID(s)</shortdescription><description>Select by observation ID(s)</description>
               
               <any limittypes="string int" type="variant"/>
               <value type="string"/>
        </param>

        <param subparam="true" name="msselect" type="string"><shortdescription>Optional complex data selection (ignore for now)</shortdescription><description>Optional complex data selection (ignore for now)</description>
                
                <value/>
        </param>

        <param name="solint" type="any"><shortdescription>Solution interval: egs. \'inf\', \'60s\' (see help)</shortdescription><description>Solution interval: egs. \'inf\', \'60s\' (see help)</description>
                
                <any type="variant"/>
                <value type="string">inf</value>
        </param>

        <param name="combine" type="string"><shortdescription>Data axes which to combine for solve (obs, scan, spw, and/or field)</shortdescription><description>Data axes which to combine for solve (obs, scan, spw, and/or field)</description>
               
               <value/>
        </param>
   
        <param name="refant" type="string"><shortdescription>Reference antenna name(s)</shortdescription><description>Reference antenna name(s)</description>
                
                <value/>
        </param>

        <param name="minsnr" type="double"><shortdescription>Reject solutions below this signal-to-noise ratio (at the FFT stage)</shortdescription><description>Reject solutions below this signal-to-noise ratio (at the FFT stage)</description>
                
                <value>3.0</value>
        </param>

        <param name="zerorates" type="bool"><shortdescription>Zero delay-rates in solution table</shortdescription><description>Zero delay-rates in solution table</description>
                
                <value>False</value>
        </param>

   <param name="globalsolve" type="bool"><shortdescription>Refine estimates of delay and rate with global least-squares solver</shortdescription><description>Refine estimates of delay and rate with global least-squares solver</description>
                
                <value>True</value>
        </param>

   <param name="niter" type="int"><shortdescription>Maximum number of iterations for least-squares solver</shortdescription><description>Maximum number of iterations for least-squares solver</description>
                
		          <value>100</value>
	</param>
   

   <param name="delaywindow" type="doubleArray"><shortdescription>Constrain FFT delay search to a window; a two-element list, units of nanoseconds</shortdescription><description>Constrain FFT delay search to a window; a two-element list, units of nanoseconds</description>
                
                <value/>
        </param>

   <param name="ratewindow" type="doubleArray"><shortdescription>Constrain FFT rate search to a window; a two-element list, units of seconds per second</shortdescription><description>Constrain FFT rate search to a window; a two-element list, units of seconds per second</description>
                
                <value/>
        </param>
   
        <param name="append" type="bool"><shortdescription>Append solutions to the (existing) table</shortdescription><description>Append solutions to the (existing) table</description>
                
                <value>False</value>
        </param>

    <param name="corrdepflags" type="bool">
      <shortdescription>Respect correlation-dependent flags</shortdescription>
      <description> If False (default), if any correlation is flagged, treat all correlations in
        the visibility vector as flagged when solving (per channel, per baseline).
        If True, use unflagged correlations in a visibility vector, even if one or more
        other correlations are flagged.
              
        Default: False (treat correlation vectors with one or more correlations flagged as entirely flagged)
  
        Traditionally, CASA has observed a strict interpretation of 
        correlation-dependent flags: if one or more correlations 
        (for any baseline and channel) is flagged, then all available 
        correlations for the same baseline and channel are 
        treated as flagged.  However, it is desirable in some 
        circumstances to relax this stricture, e.g., to preserve use
        of data from antennas with only one good polarization (e.g., one polarization
        is bad or entirely absent).  Solutions for the bad or missing polarization 
        will be rendered as flagged.

      </description>
      <value>False</value>
    </param>

        <param name="docallib" type="bool"><shortdescription>Use callib or traditional cal apply parameters</shortdescription><description>Use callib or traditional cal apply parameters</description>
                
                <value>False</value>
        </param>

        <param subparam="true" name="callib" type="string"><shortdescription>Cal Library filename</shortdescription><description>Cal Library filename</description>
                
                <value type="string"/>
        </param>

        <param subparam="true" name="gaintable" type="stringArray"><shortdescription>Gain calibration table(s) to apply on the fly</shortdescription><description>Gain calibration table(s) to apply on the fly</description>
                
                <value/>
        </param>

        <param subparam="true" name="gainfield" type="stringArray"><shortdescription>Select a subset of calibrators from gaintable(s)</shortdescription><description>Select a subset of calibrators from gaintable(s)</description>
                
                <value/>
        </param>

        <param subparam="true" name="interp" type="stringArray"><shortdescription>Temporal interpolation for each gaintable (''=linear)</shortdescription><description>Temporal interpolation for each gaintable (''=linear)</description>
                
                <value/>
        </param>

        <param subparam="true" name="spwmap" type="intArray">
	  <shortdescription>Spectral window mappings to form for gaintable(s)</shortdescription>
	  <description>Spectral window mappings to form for gaintable(s)
                     Only used if callib=False
                     default: [] (apply solutions from each calibration spw to
                     the same MS spw only)
                     Any available calibration spw can be mechanically mapped to any 
                      MS spw. 
                     Examples:
                        spwmap=[0,0,1,1] means apply calibration 
                          from cal spw = 0 to MS spw 0,1 and cal spw 1 to MS spws 2,3.
                        spwmap=[[0,0,1,1],[0,1,0,1]] (use a list of lists for multiple
                          gaintables)
	  </description>
          <type>any</type>
          <value/>
        </param>

        <param name="parang" type="bool"><shortdescription>Apply parallactic angle correction on the fly</shortdescription><description>Apply parallactic angle correction on the fly</description>
                
                <value>False</value>
        </param>
>>>>>>> master
   
    Write a solution table with delay-rates zeroed, for the case of
    &quot;manual phase calibration&quot;, so that the calibration table can be
    applied to the full dataset without the extrapolation of a non-zero delay-rate term
    affecting the data
    </description>
    <value>False</value>
  </param>

  <param name="globalsolve" type="bool">
    <shortdescription>Refine estimates of delay and rate with global least-squares solver</shortdescription>
    <description>
      Refine estimates of delay and rate with global least-squares solver

      Default: True
      Options: True|False      
    </description>
    <value>True</value>
  </param>

  <param name="niter" type="int">
    <shortdescription>Maximum number of iterations for least-squares solver</shortdescription>
    <description>Maximum number of iterations for least-squares solver
      Default: 100
    </description>
    <value>100</value>
  </param>

  <param name="delaywindow" type="doubleArray">
    <shortdescription>Constrain FFT delay search to a window</shortdescription>
    <description>Constrain FFT delay search to a window specified as a two-element list with units of nanoseconds
    Default: [None, None]
    Examples: [-10, 10]
    </description>
    <value type="vector"/>
  </param>

  <param name="ratewindow" type="doubleArray">
    <shortdescription>Constrain FFT rate search to a window</shortdescription>
    <description>Constrain FFT rate search to a window specified as a two-element list with units of seconds per second
      Default: [None, None]
      Examples: [-1e-13, 1e-13]
    </description>
    <value/>
  </param>

  <param name="append" type="bool">
    <shortdescription>Append solutions to the (existing) table</shortdescription>
    <description>Append solutions to the (existing) table
    Default: False (overwrite existing table or make
    new table)

    Appended solutions must be derived from the same
    MS as the existing caltable, and solution spws
    must have the same meta-info (according to spw
    selection and solint) or be non-overlapping.
    </description>
    <value>False</value>
  </param>
  
  <param name="docallib" type="bool">
    <shortdescription>Use callib or traditional cal apply parameters</shortdescription>
    <description>Control means of specifying the caltables
                     Default: False (Use gaintable, gainfield, interp,
                     spwmap, calwt)
                     Options: False|True

                     If True, specify a file containing cal library in
                     callib
    </description>
    <value>False</value>
  </param>

  <param subparam="true" name="callib" type="string">
    <shortdescription>Cal Library filename</shortdescription>
    <description>Specify a file containing cal library directives
    Subparameter of docallib=True
    </description>
    <value type="string"/>
  </param>

  <param subparam="true" name="gaintable" type="stringArray">
    <shortdescription>Gain calibration table(s) to apply on the fly</shortdescription>
    <description>Gain calibration table(s) to apply on the fly
    Default: '' (none)
    Subparameter of docallib=False
    Examples: 
    gaintable='ngc5921.gcal'
    gaintable=['ngc5921.ampcal','ngc5921.phcal']
    </description>
    <value/>
  </param>

  <param subparam="true" name="gainfield" type="stringArray">
    <shortdescription>Select a subset of calibrators from gaintable(s)</shortdescription>
    <description>Select a subset of calibrators from gaintable(s)
    Default: '' (all sources on the sky)

    'nearest' ==&gt; nearest (on sky) available field in
    table otherwise, same syntax as field

    Examples: 
    gainfield='0~2,5' means use fields 0,1,2,5
    from gaintable
    gainfield=['0~3','4~6'] means use field 0
    through 3
    </description>

    <value/>
  </param>

  <param subparam="true" name="interp" type="stringArray">
    <shortdescription>Temporal interpolation for each gaintable (''=linear)</shortdescription>
    <description>Interpolation parameters (in time[,freq]) for each gaintable, as a list of strings.
    Default: '' --&gt; 'linear,linear' for all gaintable(s)
    Options: Time: 'nearest', 'linear'
    Freq: 'nearest', 'linear', 'cubic',
    'spline'
    Specify a list of strings, aligned with the list of caltable specified
    in gaintable, that contain the required interpolation parameters
    for each caltable.
    * When frequency interpolation is relevant (B, Df,
    Xf), separate time-dependent and freq-dependent
    interp types with a comma (freq_after_ the
    comma). 
    * Specifications for frequency are ignored when the
    calibration table has no channel-dependence. 
    * Time-dependent interp options ending in 'PD'
    enable a &quot;phase delay&quot; correction per spw for
    non-channel-dependent calibration types.
    * For multi-obsId datasets, 'perobs' can be
    appended to the time-dependent interpolation
    specification to enforce obsId boundaries when
    interpolating in time. 
    * Freq-dependent interp options can have 'flag' appended
    to enforce channel-dependent flagging, and/or 'rel' 
    appended to invoke relative frequency interpolation

    Examples: 
    interp='nearest' (in time, freq-dep will be
    linear, if relevant)
    interp='linear,cubic'  (linear in time, cubic
    in freq)
    interp='linearperobs,splineflag' (linear in
    time per obsId, spline in freq with
    channelized flagging)
    interp='nearest,linearflagrel' (nearest in
    time, linear in freq with with channelized 
    flagging and relative-frequency interpolation)
    interp=',spline'  (spline in freq; linear in
    time by default)
    interp=['nearest,spline','linear']  (for
    multiple gaintables)
    </description>
    <value/>
  </param>

  <param subparam="true" name="spwmap" type="intArray">
    <shortdescription>Spectral windows combinations to form for gaintables(s)</shortdescription>
    <description>Spectral windows combinations to form for gaintables(s)
    Subparameter of callib=False
    default: [] (apply solutions from each spw to
    that spw only)

    Examples:
    spwmap=[0,0,1,1] means apply the caltable
    solutions from spw = 0 to the spw 0,1 and spw
    1 to spw 2,3.
    spwmap=[[0,0,1,1],[0,1,0,1]] (for multiple
    gaintables)
    </description>
    <type>any</type>
    <value/>
  </param>

  <param subparam="true" name="paramactive" type="boolArray">
    <shortdescription>Control which parameters are solved for</shortdescription>
    <description>Control which parameters are solved for; a vector of (exactly) three booleans for delay, delay-rate and dispersive delay (in that order)</description>
    Default: [True, True, False]
    Examples:
    [True, True, False] (the defaul) solves for delay and delay-rate but not dispersive delay
    [True, True, True] solves for delay, delay-rate and dispersive delay
    [True, False, False] solves only for delays
    [False, True, False] solves only for delay-rates

    It is not possible to turn off solution for the phase offset
    ("secular phase").  The choice of parameters is used in the
    least-squares solver; it does not affect the operation of the FFT
    stage, although it will affect the results in the calibration table
    if the globalsolve option is set to False.
    <value/>
  </param>

  <param name="parang" type="bool">
    <shortdescription>Apply parallactic angle correction on the fly</shortdescription>
    <description>
      Apply parallactic angle correction
      Default: False
      If True, apply the parallactic angle correction
      (required for polarization calibration)
    </description> 
    <value>False</value>
  </param>
  
   <constraints>
     <when param="selectdata">
                <equals value="True" type="bool">
                        <default param="timerange"><value type="string"/></default>
                        <default param="antenna"><value type="string"/></default>
                        <default param="scan"><value type="string"/></default>
                        <default param="observation"><value type="string"/></default>
                        <default param="msselect"><value type="string"/></default>
                </equals>
                <equals value="False" type="bool"/>
        </when>
        <when param="docallib">
                <equals value="False" type="bool">
                        <default param="gaintable"><value type="stringArray"/></default>
                        <default param="gainfield"><value type="stringArray"/></default>
                        <default param="interp"><value type="stringArray"/></default>
                        <default param="spwmap"><value type="intArray"/></default>
                </equals>
                <equals value="True" type="bool">
                        <default param="callib"><value type="string"/></default>
                </equals>
        </when>
   </constraints>
</input>

<example>
  For more information, see the task pages of gaincal in CASA Docs:

  https://casa.nrao.edu/casadocs/
      minsnr -- Reject solutions below this SNR
              default: 3.0 
</example> 

</task>
</casaxml>
