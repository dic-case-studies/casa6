<casaxml xsi:schemaLocation="http://casa.nrao.edu/schema/casa.xsd file:///opt/casa/code/xmlcasa/xml/casa.xsd" xmlns="http://casa.nrao.edu/schema/psetTypes.html" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

<task type="function" name="sdatmcor" category="single dish">
     <shortdescription>Offline correction of residual atmospheric features</shortdescription>

<description>

    The task sdatmcor provides the capability of offline correction of
    residual atmospheric features in the calibrated single-dish spectra
    which results from the subtle difference of elevation angle between
    ON_SOURCE and OFF_SOURCE measurements.

    The correction fator is derived from the atmosphere model based on
    the atmospheric properties (temperature, pressure, etc.) measured
    during the observation. The model is constructed by the atmosphere
    (at) tool.

</description>

<input>

    <param type="string" name="infile">
        <shortdescription>name of input MS.</shortdescription>
        <description>name of input MS.</description>
        <value/>
    </param>

    <param type="string" name="datacolumn" ignorecase="true">
        <shortdescription>name of data column to be used [&quot;data&quot;, &quot;float_data&quot;, or &quot;corrected&quot;]</shortdescription>
        <description>name of data column to be used [&quot;data&quot;, &quot;float_data&quot;, or &quot;corrected&quot;]</description>

        <value>data</value>
        <allowed kind="enum">
            <value>data</value>
            <value>float_data</value>
            <value>corrected</value>
       </allowed>
    </param>

    <param type="string" name="outfile">
        <shortdescription>name of output MS.</shortdescription>
        <description>name of output MS.</description>
        <value/>
    </param>

    <param type="bool" name="overwrite">
            <shortdescription>allow to overwrite the output file if already exists.</shortdescription>
            <description>allow to overwrite the output file if already exists.</description>
            <value type="bool">False</value>
    </param>

    <param type="string" name="field">
        <shortdescription>field selection. (&quot;&quot; = all)</shortdescription>
        <description>field selection. (&quot;&quot; = all)</description>
        <value/>
    </param>

    <param type="string" name="spw">
        <shortdescription>spw selection. (&quot;&quot; = all)</shortdescription>
        <description>spw selection (&quot;&quot; = all)</description>
        <value/>
    </param>

    <param type="string" name="scan">
        <shortdescription>scan selection. (&quot;&quot; = all)</shortdescription>
        <description>scan selection. (&quot;&quot; = all)</description>
        <value/>
    </param>

    <param type="string" name="antenna">
        <shortdescription>antenna selection. (&quot;&quot; = all)</shortdescription>
        <description>antenna selection. (&quot;&quot; = all)</description>
        <value type="string"></value>
    </param>

    <param  type="string" name="correlation">
        <shortdescription>correlation (polalization) selection. (&quot;&quot; = all)</shortdescription>
        <description>correlation (polalization) selection. (&quot;&quot; = all)</description>
        <value type="string"></value>
    </param>

    <param type="string" name="timerange">
        <shortdescription>timerange selection, e.g. &quot;09:14:0~09:54:0&quot; (&quot;&quot; = all) (see examples in help)</shortdescription>
        <description>timerange selection, e.g. &quot;09:14:0~09:54:0&quot; (&quot;&quot; = all) (see examples in help)</description>
        <value/>
    </param>

    <param name="intent" type="string">
        <shortdescription>intent selection. (&quot;&quot; = all)</shortdescription>
        <description>intent selection. (&quot;&quot; = all)</description>
        <value type="string"></value>
    </param>

    <param name="observation" type="string">
        <shortdescription>observation selection. (&quot;&quot; = all)</shortdescription>
        <description>observation selection. (&quot;&quot; = all)</description>
        <value type="string"></value>
    </param>

    <param name="feed" type="string">
        <shortdescription>feed selection. (&quot;&quot; = all)</shortdescription>
        <description>feed selection. (&quot;&quot; = all)</description>
        <value type="string"></value>
    </param>

    <param name="msselect" type="string">
        <shortdescription>taql selection. (&quot;&quot; = all)</shortdescription>
        <description>taql selection. (&quot;&quot; = all)</description>
        <value type="string"></value>
    </param>

    <param name="outputspw" type="string">
        <shortdescription>select spws to output, same syntax of spw.(&quot;&quot; = all)</shortdescription>
        <description>select spws to output, same syntax of spw.(&quot;&quot; = all)</description>
        <value type="string"></value>
    </param>

    <param name="gainfactor" type="any">
        <shortdescription>gain factor to multiply correction term</shortdescription>
        <description>Gain factor to multiply correction term. Default is 1.0. Fixed factor can be given as float value. If factors vary with spw, they can be specified by either dictionary whose keys are spw id or caltable. For caltable, inverse square of stored value is applied.</description>
        <any type="variant" limittypes="double record string"/>
        <value type="double">1.0</value>
    </param>

    <param name="dtem_dh" type="any">
        <shortdescription>temperature gradient. (K/km), e.g. -5.6 ,(&quot;&quot; = Tool default) </shortdescription>
        <description>temperature gradient. (K/km), e.g. -5.6 ,(&quot;&quot; = Tool default)</description>
        <any type="variant"  limittypes="string double"/>
        <value type="string"></value>
    </param>

    <param name="h0" type="any">
        <shortdescription>scale height for water. (km) e.g. 2.0 ,(&quot;&quot; = Tool default)</shortdescription>
        <description>scale height for water. (km) e.g. 2.0 ,(&quot;&quot; = Tool default)</description>
        <any type="variant"  limittypes="string double"/>
        <value type="string"></value>
    </param>

    <param name="atmtype" type="any">
        <shortdescription>atmtype. (1: tropical, 2: mid latitude summer, 3: mid latitude winter, 4: subarctic summer, 5: subarctic winter) (&quot;&quot; =2)</shortdescription>
        <description>atmtype.(1: tropical, 2: mid latitude summer, 3: mid latitude winter, 4: subarctic summer, 5: subarctic winter) (&quot;&quot; =2)</description>
        <any type="variant"  limittypes="string int"/>
        <value type="string">2</value>
    </param>

    <param name="atmdetail" type="bool">
        <shortdescription>expose sub-parameters to assign True.</shortdescription>
        <description>expose sub-parameters, if True.</description>
        <value type="bool">False</value>
    </param>

<!--
   SubParameters  when 'atmdetail' is True
-->

    <param name="altitude" type="any" subparam="true" >
        <shortdescription>altitude (m). (&quot;&quot; = value from MS.)</shortdescription>
        <description>altitude (m). (&quot;&quot; = value from MS.)</description>
        <any type="variant"  limittypes="string double"/>
        <value type="string"></value>
    </param>

    <param name="temperature" type="any" subparam="true">
        <shortdescription>ambient temperature (K). (&quot;&quot; = value from MS.)</shortdescription>
        <description>ambient temperature (K). (&quot;&quot; = value from MS.)</description>
        <any type="variant"  limittypes="string double"/>
        <value type="string"></value>
    </param>

    <param name="pressure" type="any" subparam="true">
        <shortdescription>ambient pressure (mbar). e.g. 1013.25 ,(&quot;&quot; = value from MS.)</shortdescription>
        <description>ambient pressure (mbar). e.g. 1013.25 ,(&quot;&quot; = value from MS.)</description>
        <any type="variant"  limittypes="string double"/>
        <value type="string"></value>
    </param>

    <param name="humidity" type="double" subparam="true">
        <shortdescription>humidity [percent]. -1 or the value (0.0 - 100.0) (&quot;&quot; = Tool default(-1))</shortdescription>
        <description>humidity [percent]. -1 or the value (0.0 - 100.0) (&quot;&quot; = Tool default(-1))</description>
        <value type="double">-1</value>
    </param>

    <param name="PWV" type="any" subparam="true">
        <shortdescription>zenith water vapor [mm]. (&quot;&quot; = Tool default)</shortdescription>
        <description>zenith water vapor [mm]. (&quot;&quot; = Tool default)</description>
        <any type="variant"  limittypes="string double"/>
        <value type="string"></value>
    </param>

    <param name="dp" type="any" subparam="true">
        <shortdescription>initial pressure step [mbar].(&quot;&quot; = Tool default)</shortdescription>
        <description>initial pressure step [mbar].(&quot;&quot; = Tool default)</description>
        <any type="variant"  limittypes="string double"/>
        <value type="string"></value>
    </param>

    <param name="dpm" type="double" subparam="true">
        <shortdescription>pressure multiplicative factor for steps. (&quot;&quot; = Tool default)</shortdescription>
        <description>pressure multiplicative factor for steps. (&quot;&quot; = Tool default)</description>
        <value type="double">-1</value>
    </param>

    <param name="layerboundaries" type="any" subparam="true">
        <shortdescription>altitude of user-defined temperature profile [m]. (&quot;&quot; = Tool default)</shortdescription>
        <description>altitude of user-defined temperature profile [m]. Number of values should be identical to the number for layertemperature. (&quot;&quot; = Tool default)</description>
        <any type="variant"  limittypes="string stringArray doubleArray"/>
        <value type="string"></value>
    </param>

    <param name="layertemperature" type="any" subparam="true">
        <shortdescription>user-defined temperature profile [K]. (&quot;&quot; = Tool default)</shortdescription>
        <description>user-defined temperature profile [K]. Number of values should be identical to the number for layerboundaries. (&quot;&quot; = Tool default)</description>
        <any type="variant"  limittypes="string stringArray doubleArray"/>
        <value type="string"></value>
    </param>

<!--
    Constraints (activate subpram)
-->
    <constraints>
      <when param="atmdetail">
        <equals value="False" type="bool"/>
        <equals value="True" type="bool">
            <default param="altitude"><value type="string"></value></default>
            <default param="temperature"><value type="string"></value></default>
            <default param="pressure"><value type="string"></value></default>
            <default param="humidity"><value type="double">-1</value></default>
            <default param="PWV"><value type="string"></value></default>
            <default param="dp"><value type="string"></value></default>
            <default param="dpm"><value type="double">-1</value></default>
            <default param="layerboundaries"><value type="string"></value></default>
            <default param="layertemperature"><value type="string"></value></default>
        </equals>
      </when>
    </constraints>

</input>

<example>
</example>
<returns>void</returns></task>
</casaxml>
